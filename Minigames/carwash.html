<!DOCTYPE html>
<head>
   <title>ATC Game Center</title>
    <link href="mini.css" type="text/css" rel="stylesheet">
   <link rel="preconnect" href="https://fonts.gstatic.com">
   <link href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap" rel="stylesheet">
<head>
<body>
   <!-- ENDSCREEN STEP 1 -->
   <div id="endscreen" class="box stack-top" style="background: black;">
    <button id="nextgame">Click to go to the next game</button>
    </div>
   <div class="nav-wrapper">
      <!-- <div class="left-nav">
         <div class="nav-link-wrapper ">
             <a href="index.html">Home</a>
         </div>
           <div class="nav-link-wrapper">
               <a href="games.html">Games</a>
           </div>
       </div> -->

      <div class="right-nav">
          <div class="brand">
              <div>ATC Game Center</div>
          </div>

      </div>
   </div> 

   <div class = "car">
       <p id="wintext"></p>

       <div id="vroom">
            <img id="myCar" src="CarImages/car0.png" width = 100%>
        </div>

        <div id="bubbles">
            <img id="bub" src="CarImages/Nothing.png" width = 125% height = 275%>
            
        </div>
   </div>
   </body>
   
   <script>
// END SCREEN STEP 2
document.getElementById('endscreen').style.visibility='hidden';


       var car = 0;
       var numCars = 7;
       document.getElementById('bub').style.animationPlayState = 'none';
       let beat = new Audio('CarImages/TaDa.mp3');
       let bubblebeat = new Audio('CarImages/bubbles.mp3')
       var isDone = false;
       //image nam follow format car#.png
      
       //document.addEventListener('click', () => {
        document.body.onkeydown=function(){
         if(isDone){
            // ENDSCREEN STEP 4
            //CHANGE WHEN NEW GAME IS ADDED 
            // Make sure to not include the game you're currently in
            let gameNames = ["reactionclick.html", "crossyroad.html", "fruitninja.html"]
            var url = gameNames[Math.floor(Math.random()*gameNames.length)];
            window.open(url,"_self");
         }

        //    while(document.getElementById('bub').innerHTML.y<=1000){
        //     document.getElementById('bub').innerHTML.y+=200;
        //    }
           // switch the picture
           
            
           
            if(car>= numCars){
                document.getElementById('wintext').innerHTML = 'You Win!';
                 beat.volume=0.1;
                beat.play();
                isDone=true;
                sessionStorage.setItem("isDone","true");
                console.log(sessionStorage.getItem("isDone"));
                // beat.load();
                //next mini game
                // ENDSCREEN STEP 3
            setTimeout(function(){
                document.getElementById('endscreen').style.visibility='visible';
                 
                },3069);
            }
            else{
                transition();
            }
            // else{
            //     document.getElementById('myCar').src="CarImages/car"+car+".png";
            // }
           
        

    //    });
            }

       function transition(){
           //resetPos();
        document.getElementById('bub').src="CarImages/Bubbles.png";
        myMove();
        // setTimeout('', 3000);
        //  setTimeout(function(){
        //     car++;
        // document.getElementById('myCar').src="CarImages/car"+car+".png";
        // },1000);
        // setTimeout(function(){
        // document.getElementById('bub').src="CarImages/Nothing.png";
        // //document.getElementById('bub').style.animationPlayState = 'none';
        // },3000);
        
        
        
        //  setTimeout(nothing(), 3000);
        // document.getElementById('bub').src="CarImages/Nothing.png";

       }

       var id = null;
        function myMove() {
            bubblebeat.volume=1;
                bubblebeat.play();
        document.getElementById('bub').style.top = -100 + 'px';
        var elem = document.getElementById("bub");
        var pos = -1050;
        
        clearInterval(id);
        var changed = false;
        id = setInterval(frame, 1);
        function frame() {
            
            if (pos >= 1000) {
            clearInterval(id);
            document.getElementById('bub').src="CarImages/Nothing.png";
            }
            else {
                 if(pos >= 250 && !changed){
                    car++;
                    changed = true;
                    document.getElementById('myCar').src="CarImages/car"+car+".png";
                    console.log("changed car to CarImages/car"+car+".png")
                }
            pos+=8;
            //document.getElementById('bub').style.top = pos + 'px';
            document.getElementById('bub').style.left = pos + 'px';
            }
        }
        } 
       
       function resetPos(){
        document.getElementById('bub').style.left = -200 + 'px'; 
        document.getElementById('bub').style.animationPlayState = 'running';
       }
    //    function nothing(){
    //        var x = 0;
    //    }
   </script>
